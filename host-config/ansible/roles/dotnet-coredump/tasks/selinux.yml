---
# SELinux configuration tasks for dotnet-coredump role

- name: Check if SELinux is enabled
  ansible.builtin.stat:
    path: /sys/fs/selinux
  register: selinux_enabled
  tags: selinux

- name: Set SELinux context for coredump directory
  ansible.builtin.command:
    cmd: "semanage fcontext -a -t container_file_t '{{ coredump_directory }}(/.*)?'"
  when: selinux_enabled.stat.exists
  tags: selinux

- name: Apply SELinux context to coredump directory
  ansible.builtin.command:
    cmd: "restorecon -R {{ coredump_directory }}"
  when: selinux_enabled.stat.exists
  tags: selinux

- name: Enable container_manage_cgroup SELinux boolean
  ansible.builtin.command:
    cmd: "setsebool -P container_manage_cgroup on"
  when: selinux_enabled.stat.exists
  tags: selinux
